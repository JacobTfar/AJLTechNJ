---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import ContactUs from '~/components/widgets/Contact.astro';
import Features2 from '~/components/widgets/Features2.astro';

const metadata = {
  title: 'Contact',
};
---

<Layout metadata={metadata}>
  <!-- HeroText Widget ******************* -->

  <HeroText tagline="Contact" title="Let's Connect!" />

  <ContactUs
    id="form"
    title="Drop us a message today!"
    subtitle="Email is the fastest way to reach us! For quicker answers, explore our FAQs section. You may find the solution you're looking for right there! If not, our support team is delighted to help you."
    inputs={[
      {
        type: 'text',
        name: 'from_name',
        label: 'Name',
      },
      {
        type: 'email',
        name: 'from_email',
        label: 'Email',
      },
    ]}
    textarea={{
      label: 'Message',
      name: 'message',
    }}
    disclaimer={{
      label:
        'By submitting this contact form, you acknowledge and agree to the collection of your personal information.',
    }}
    description="Our support team typically responds within 24 business hours."
  />

  <!-- Features2 Widget ************** -->

  <Features2
    title="We are here to help!"
    items={[
      {
        title: 'General Inquiries',
        description: `Contact us for questions about our services, pricing, scheduling appointments, or general information about AJL Tech NJ.`,
        icon: 'tabler:help-circle',
      },
      {
        title: 'Technical Support',
        description:
          'Get help with ongoing tech issues, subscription support, troubleshooting assistance, or questions about completed services.',
        icon: 'tabler:settings',
      },
      {
        title: 'Business Services',
        description:
          'Reach out for custom network installations, enterprise solutions, security system setup, or specialized business technology needs.',
        icon: 'tabler:building',
      },
      {
        title: 'Phone (Coming Soon)',
        description: 'Dedicated business line in setup - Please use email for now',
        icon: 'tabler:headset',
      },
      {
        title: 'General Email',
        description: 'info@ajltechnj.com',
        icon: 'tabler:mail',
      },
      {
        title: 'Technical Support',
        description: 'support@ajltechnj.com',
        icon: 'tabler:tool',
      },
    ]}
  />
</Layout>

<!-- EmailJS Integration -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js" is:inline
></script>
<script type="text/javascript" is:inline>
  // Initialize EmailJS with your public key
  emailjs.init('Ck9gkjhX0wmiVatpv');

  // Handle form submission
  document.addEventListener('DOMContentLoaded', function () {
    console.log('DOM loaded, looking for form...');
    const form = document.getElementById('contactForm');
    console.log('Found form:', form);

    if (form) {
      console.log('Setting up form event listener...');
      form.addEventListener('submit', function (event) {
        console.log('Form submit event triggered!');
        event.preventDefault();
        console.log('Default prevented - EmailJS will handle this');

        // Debug: Log form data
        const formData = new FormData(form);
        console.log('Form data being sent:');
        for (const [key, value] of formData.entries()) {
          console.log(key + ': ' + value);
        }

        // Change button text to show loading
        const submitButton = form.querySelector('button[type="submit"]') || form.querySelector('input[type="submit"]');
        const originalText = submitButton.textContent || submitButton.value;
        submitButton.textContent = 'Sending...';
        submitButton.disabled = true;

        // Send email using EmailJS
        emailjs
          .sendForm('service_rqrfp3j', 'template_nobdnyg', form)
          .then(function (response) {
            console.log('SUCCESS!', response.status, response.text);
            console.log('Email sent to EmailJS successfully');
            alert("Message sent successfully! We'll get back to you within 24 hours.");
            form.reset();
          })
          .catch(function (error) {
            console.error('FAILED...', error);
            console.error('Error details:', error.text || error.message);
            alert('Failed to send message. Please try again or email us directly at info@ajltechnj.com');
          })
          .finally(function () {
            // Reset button
            submitButton.textContent = originalText;
            submitButton.disabled = false;
          });
      });
    } else {
      console.error('Contact form not found! Looking for #contactForm');
      console.log('Available forms on page:', document.querySelectorAll('form'));
    }
  });

  // Backup: Try again after window loads (in case of timing issues)
  window.addEventListener('load', function() {
    if (!document.getElementById('contactForm')) {
      console.log('Trying alternative form selection...');
      const forms = document.querySelectorAll('form');
      if (forms.length > 0) {
        const form = forms[0]; // Use the first form found
        console.log('Found form without ID, adding event listener:', form);
        form.id = 'contactForm'; // Add the missing ID
        form.addEventListener('submit', function (event) {
          console.log('Backup form handler triggered!');
          event.preventDefault();
          
          // Send via EmailJS (same logic as above)
          emailjs
            .sendForm('service_rqrfp3j', 'template_nobdnyg', form)
            .then(function (response) {
              console.log('SUCCESS!', response.status, response.text);
              alert("Message sent successfully! We'll get back to you within 24 hours.");
              form.reset();
            })
            .catch(function (error) {
              console.error('FAILED...', error);
              alert('Failed to send message. Please email us directly at info@ajltechnj.com');
            });
        });
      }
    }
  });
</script>
